
前面看到BIOS引导中，在最后加载引导设备的第一个扇区到物理内存0x7C00，然后跳转到0x7C00继续执行。这里加载到0x7C00中的内容就是启动过程中接下来要编写的主引导记录，即MBR。

视频课程中有一张系统启动流程图，先放到这里，如下图1所示。系统加电的过程之前学习过，这一节其实是中间两个部分的内容，即MBR和DBR的加载。

<div align="center">
![图2 4G和1M内存空间处BIOS内容对比](D:\OS\ucoreOS\simple-os-book-notes\2017-10-25-tsinghua-os-course-ucore-MBR-DBR-BIOS-to-bootloader.jpg)
</div>

#### MBR ####

为什么有MBR？磁盘上有多种文件系统，用BIOS直接加载内核意味着它要了解文件系统，但是文件系统那么多，BIOS显然无法了解所有的种类！那就约定引导设备的第一个扇区用于加载系统内核。不同文件系统可以用不同MBR，做到文件系统和BIOS的解耦合，也就有了更好的扩展性！

其实现代的机器大多是多分区形式，在MBR中保存了分区表来表示系统有多少个硬盘分区。那么主引导记录的任务就变成了从系统分区表中找活动分区，再加载活动分区的引导记录，这个引导记录是存在文件系统中且可以被修改。它（DBR）就和文件系统紧密相关，可以解析文件系统，加载文件！

MBR中有446字节可以作为引导代码，其后64字节为分区表，四项内容，每个分区表项为16字节，最后两个字节为标识码！

！！！！！这个引导扇区需要自己编写！！！！



有分区表找到活动分区，然后需要加载活动分区的引导扇区！继续执行，活动分区引导扇区中就包含了一条跳转指令，文件系统信息，以及文件系统识别的代码，用于加载bootloader。

！！！！有两个需要搞，一个是DBR编写，再就是如何将DBR写到磁盘指定位置！！！！

加载起来bootloader以后，它会加载系统的启动配置，现实启动菜单，选择了启动的系统后，开始加载内核



### 中断，异常和系统调用 ###

为何需要中断,异常和系统调用?在操作系统中内核是可以信任,可以执行特权指令,但是它也需要给应用程序提供服务,同时还需要对外设的管理和交互。这就需要系统调用供应用程序调用，以提供服务；对于需要与硬件交互时，为了提高系统性能，则需要中断来提供内核和外设的交互；而对于一些指令执行中遇到的问题是需要内核进行处理的，这就是异常处理。

内核和外部交互基本有三个途径，中断，异常和系统调用！中断负责内核与硬件交互，相应硬件请求；异常用于处理CPU执行中出现的错误情况；系统调用则是内核提供给应用程序的服务接口，有需要时由应用程序直接调用！

三种系统调用的区别与联系：

* 中断由外部硬件设备发起的处理请求，在两条指令之间触发。
* 系统调用由应用程序主动向内核发起的服务请求。
* 异常则是非法指令或其它情况导致指令执行失败（比如内存访问错误）后的处理请求。它出现在指令执行中

！！！！这块要处理中断表，设置中断表寄存器！！！！实模式下的中断呢？？

！！！！编写系统调用，了解系统调用的过程，进行一次完整调试！！！！

1 bootloader功能
开启保护模式，保护模式的段机制生效，要做处理！！！！！
     !!!!!!段表要设置  GDT!!!!!!!!
读取内核，并加载到固定位置
控制权转移，跳转到内核执行，即进入内核入口点

其实这里可以先不用什么文件系统，可以以后优化

GCC 内联汇编  /  